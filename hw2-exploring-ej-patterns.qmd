---
title: "HW2: Exploring Patterns of Environmental Justice"
author: "Sofia Rodas"
date: October 18, 2025
format: html
message: false
warning: false
---
# Introduction
As a racially diverse area of the United States, Los Angeles acts as a case study for the far reaching environmental injustices that occur nationwide. In the 1930's the Home Owner's Loan Corporation (HOLC) gave neighborhoods grades from A to D defining what portions of the city they perceived as worthy of real estate investments. Grade A was given to "more desirable" neighborhoods ranging down to grade D, "more undesirable" neighborhoods. These grades were given based on racial prejudices. The consequence is that even today effects from this grading system manifest in the form of unequal risk to being exposed to environmental hazards. This project explores contemporary symptoms of what has come to be known as redlining. 

**Note on data limitations:** The Environmental Justice data does not have a column for cities, therefore the Environmental Justice data contains data from all of Los Angeles County even after filtering. Los Angeles County contains 88 cities according to the official Los Angeles County government webpage. Explanations are provided in the workflow as to how this data limitation is addressed throughout.

```{r}
# Load needed libraries 
library(tidyverse)
library(sf) # For handling vector data
library(tmap) # For making maps
library(spData) # Pre-loaded spatial data
library(kableExtra) # For making tables
library(patchwork) # For combining graphs
```

#### Read in data
```{r}
#| output: false
# Read in environmental justice data
ejscreen <- st_read(here::here("data", "ejscreen", "EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb"))

# Read in redlining data
redlining <- st_read(here::here("data", "mapping-inequality", "mapping-inequality-los-angeles.json"))

# Read in biodiversity data
bio_div <- st_read(here::here("data", "gbif-birds-LA", "gbif-birds-LA.shp"))
```
Select for Los Angeles County data. This reduces the amount of processing time for future joins and mapping. 
```{r}
# There is no city column so selecting for county 
 la_ejscreen <- ejscreen |> 
  filter(CNTY_NAME == "Los Angeles County")
```
### CRS inspection
Looking at the CRS for all of the datasets: 
```{r}
#| output: false
# EJ screen CRS
st_crs(la_ejscreen)
```


```{r}
#| output: false
# Redlining CRS
st_crs(redlining)
```


```{r}
#| output: false
# Biodiversity CRS
st_crs(bio_div)
```
The CRS differ between the datasets, so further analysis is needed to decide what is the best coordinate reference system for this project. 

Note: The CRS outputs are hidden for a cleaner document. 

### Check to see if the projections are geographic or projected.
```{r}
st_crs(la_ejscreen)$IsGeographic
st_crs(redlining)$IsGeographic
st_crs(bio_div)$IsGeographic
```
 
Since the Environmental Justice data is projected, and projected coordinate reference systems are better for 2D map making, the crs from the Environmental Justice data, WGS: Pseudo-Mercator, will be used for this mapping assignment. 

#### Change the CRS of redlining data and biodiversity data to match the CRS of the Environmental Justice data.  
```{r}
# Set the CRS to that of the environmental justice data
redlining <- st_transform(redlining, crs = st_crs(la_ejscreen))
bio_div <- st_transform(bio_div, crs = st_crs(la_ejscreen))
```

#### Making sure the CRS are the same for all of the datasets
```{r}
# Set the CRS to equal each other in a boolean to make sure they are all the same
# Check relining data is using the same CRS as la_ejscreen data
if (st_crs(la_ejscreen)==st_crs(redlining)){
  print("it's a match!")
}else {
    print("still not a match")
}

# Check bio diversity data is using the same CRS as la_ejscreen data
if (st_crs(la_ejscreen)==st_crs(bio_div)){
  print("it's a match!")
}else {
    print("still not a match")
  }
```

# Part 1: Legacy of Redlining in current environmental (in)justice
### 1. Create a map of historical relining neighborhoods 

When considering how to construct a map of Los Angeles' redlined neighborhoods, the growth of Los Angeles in the last century indicates that not all of present day Los Angeles would have a HOLC grade. Therefore, a base-layer is added to make the map useful in analyzing what sections of Los Angeles have differing HOLC grades. 

```{r}
la_holc <- tm_shape(redlining) +
  tm_basemap() +
  tm_polygons() +
  tm_fill(fill = "grade",
          fill.scale = tm_scale_discrete(values = c("#9ca260", 
                                                    "#98aeac",
                                                    "#d7b65d",
                                                    "#cb6e7e")), # Use historic colors
          fill.legend = tm_legend(title = "HOLC Ranked Redlining",
                                  labels = c("A", 
                                             "B", 
                                             "C", 
                                             "D", 
                                             "NA"))) +
  tm_borders() + # Add borders on top of fill
  tm_title(text = "Los Angeles Historic Home Owners' Loan Corporation (HOLC) Redlining",
           frame = TRUE) + 
  tm_compass() +
  tm_scalebar() 

# Display map
print(la_holc)

# Save map and define the size
tmap_save(la_holc, 
          here::here("figs", "la_holc.png"), 
          height = 8, 
          width = 14)
```

### 2. Create a table summarizing census block groups that fall within each HOLC grade 

#### Combine the redlining data and la_ejscreen data

Create a table that shows the percentage of census blocks that fall within each HOLC grade. The number of census blocks that do not have HOLC grades is also calculated in the table. 

Note on data limitations: The la_ejscreen data does not have a column for cities, therefore the la_ejscreen data contains data from all of Los Angeles County. Los Angeles County contains 88 cities according to the official Los Angeles County government webpage. To maintain an approximation of Los Angeles proper st_intersects was employed for this join. 
```{r}
# Join redlining and la_ejscreen using the geographic data
ej_redlining <- st_join(la_ejscreen, redlining, join = st_intersects)

# Drop the geographic data since a table does not require geo-spatial data
ej_redlining <- st_drop_geometry(ej_redlining)
```

```{r}
# Change variable names to lower_snake
ej_redlining <- janitor::clean_names(ej_redlining)
```
##### Workflow for calculating percentage of census blocks in each HOLC grade 
Group data by HOLC grade and summarize the number of census blocks in each HOLC grade. Ungroup to ensure that the percentages are calculated based on all census blocks. Calculate percentages and round to 3 decimals. Use kableExtra to create an aesthetic table.
```{r}
# Calculate percentage of census block groups that fall within each HOLC grade
perc_cen_block <- ej_redlining |> 
  group_by(grade) |> 
  summarise(grade_cnt = n()) |> 
  ungroup() |> 
  mutate(grade_freq = round((grade_cnt/sum(grade_cnt)* 100), 3))

# Use kableExtra to create an aesthetic table for 
perc_cen_block |> 
  kable(format = "html", # Necessary to add header
        col.names = c("Grade", "Count", "Percent"),
        padding = 3) |> 
  add_header_above(c("Los Angeles Census Block HOLC Grade Percentages"= 3))
```
#### Table Analysis
As expected the largest percentage of census blocks do not have a historic HOLC score. This is due to the rapid expansion of Los Angeles in the past century. The second highest percentage of census blocks HOLC scores is C, followed by D and B. The lowest percentage of census blocks have a historic HOLC score of A. 

### 3. Create two visualizations summarizing current conditions (from the EJScreen data) within HOLC grades using the mean of percentile low life expectancy and percentile for Particulate Matter 2.5 variables.

#### Graph average percentile low life expectancy per HOLC grade area
Group data by HOLC grade and summarize the mean low life expectancy percentile in each HOLC grade. Graph the mean low life expectancy percentile for each grade.
```{r}
# Calculate mean of percent of percentile for low life expectancy in HOLC Grades 
lifeexppct_plot <- ej_redlining |> 
  drop_na() |> 
  group_by(grade) |> 
  summarise(mean_perce_low_lifeexppct = mean(p_lifeexppct, na.rm = TRUE)) |> 
  ungroup() |> 
  ggplot(aes(x = grade, y = mean_perce_low_lifeexppct)) +
  geom_col(aes(fill = grade)) + # geom_col allows for both an x and y
  labs(title = "Low Life Expectancy Average Percentile",
       x = "HOLC Grade",
       y = "Average Percentile of Low Life Expectancy") +
  scale_fill_manual(values = c("#9ca260", 
                               "#98aeac", 
                               "#d7b65d", 
                               "#cb6e7e")) + # Match colors to historic maps
  theme_minimal() +
  theme(plot.title = element_text(size=12)) # Adjust title size
```


#### Graph average percent particulate matter 2.5 per HOLC grade area
Group data by HOLC grade and summarize the mean Particulate Matter 2.5 (PM 2.5) percentile in each HOLC grade. Graph the mean PM2.5 Percentile for each grade.
```{r}
# Calculate mean of percentile of Particulate Matter 2.5 (PM 2.5) in HOLC Grade Areas
p_pm25_plot <- ej_redlining |> 
  drop_na() |>
  group_by(grade) |> # Group by grade 
 summarise(mean_perce_pm25 = mean(p_pm25, na.rm = TRUE)) |>  # Calculate mean pm2.5
  ungroup() |> 
ggplot(aes(x = grade, y = mean_perce_pm25)) +
  geom_col(aes(fill = grade)) + # geom_col allows for both an x and y for aesthetics
  labs(title = "PM 2.5 Average Percentile",
       x = "HOLC Grade",
       y = "Average Percentile for PM 2.5") +
  scale_fill_manual(values = c("#9ca260", 
                               "#98aeac", 
                               "#d7b65d", 
                               "#cb6e7e")) + # Match colors to historic maps
  theme_minimal() +
  theme(plot.title = element_text(size=12)) # Adjust title size
```

##### Patchwork
Use patchwork to create one visualization for percentile low life expectancy and percentile high Particulate Matter 2.5. Set spacers and use layout options to create an aesthetic final graph.
```{r}
# Create on plot with patchwork 
holc_grade_con <- lifeexppct_plot + 
  plot_spacer() + # Add space between plots
  p_pm25_plot + 
  plot_layout(guides = "collect", # Add only one legend
              widths = c(4,-1,4)) # Dimensions for spacer

# View combined visual
print(holc_grade_con) 

# Save for future use
ggsave(here::here("figs", "holc_grade_cond.png"), holc_grade_con)
```

#### Graph Analysis

Both the average percent of low life expectancy and average percentile of Particulate Matter 2.5 (PM2.5) per HOLC grade area show that those areas historically less likely to acquire loans from HOLC have present day adverse effects. Low life expectancy average percentages and PM2.5 Average Percentiles clearly increases the worse the grade they were given by the HOLC. In other words, in those areas where HOLC blocked communities from acquiring mortgages in the 1930's, today are areas associated with mean higher rates of low life expectancy average percentages and higher rates of average high PM 2.5 percentiles. This clear visual gives weight to show that historical injustices continue to manifest in adverse affects for those living in marginalized communities. 

# Part 2: Legacy of redlining in biodiversity observations
### Create a visualization of the percent of observations within redlined neighborhoods within each HOLC grade

Combine the redlining data and bird observation data
```{r}
# Join redlining using the geographic data
bio_redlining <- st_join(bio_div, redlining, join = st_within)

# Drop the geographic data since graphs do not require it
bio_redlining <- st_drop_geometry(bio_redlining)
```
##### Workflow for calculating percentage of bird sightings in each HOLC grade 
Group data by HOLC grade and summarize the number of observations in each HOLC grade. Ungroup to ensure that the percentages are calculated based on all census blocks. Calculate percentages by dividing the individual count by the total sum of observations. 
```{r}
# Calculate the number of observations in each grade 
birds_holc <- bio_redlining |> 
  drop_na() |>
  group_by(grade) |> 
  summarise(observation_cnt = n()) |>
  ungroup() |> 
  mutate(observation_freq = observation_cnt/sum(observation_cnt, na.rm = TRUE)) |>
  ggplot(aes(x = grade, y = observation_freq)) + 
  geom_col(aes(fill = grade)) +
  labs(title = "Percent of Bird Observations per HOLC Grade",
       x = "HOLC Grade",
       y = "Percent of Bird Observations") +
  scale_fill_manual(values = c("#9ca260", 
                               "#98aeac", 
                               "#d7b65d", 
                               "#cb6e7e")) + # Match colors to historic maps
  theme_minimal()

# Display graph
print(birds_holc)

# Save for future use
ggsave(here::here("figs", "birds_holc.png"), birds_holc)
```

### Reason our findings do not match the findings of Ellis-Soto et al. 2023
Ellis-Soto et al. (2023) find that those areas rated more favorably on the HOLC grading scale have more citizen bird observations. The finding that those areas with higher HOLC scores have more bird observations is not supported by the analysis in this project. The HOLC grade with the most bird observations according to the graphic above is HOLC grade C. 

Ellis-Soto et al. (2023) states that that "to calculate how the number of bird observations differed across HOLC grades, we calculated the sampling density of bird records by accounting for the area of each HOLC grade per city in km2." The discrepancy in the findings from this analysis are attributed to no adjustment being made for the greater number of HOLC areas being graded as HOLC C, as shown in the table above. The Ellis-Soto et al. (2023) is a better representation of the data as their account of unevenly distributed HOLC grades interprets the data based on the size discrepancies. 

# References

- Ellis-Soto, D., Chapman, M., & Locke, D. H. (2023). Historical redlining is associated with increasing geographical disparities in bird biodiversity sampling in the United States. Nature Human Behaviour, 1-9. [URL](https://ecoevorxiv.org/repository/view/3736/)
- - Gee, G. C. (2008). A multilevel analysis of the relationship between institutional and individual racial discrimination and health status. American journal of public health, 98(Supplement_1), S48-S56.
- Hoffman, J. S., Shandas, V., & Pendleton, N. (2020). The effects of historical housing policies on resident exposure to intra-urban heat: a study of 108 US urban areas. Climate, 8(1), 12.
- LA COUNTY CITIES. Accessed October 18, 2025. [https://lacounty.gov/newsroom/public-information/la-county-cities/](https://lacounty.gov/newsroom/public-information/la-county-cities/)
- Nardone, A., Rudolph, K. E., Morello-Frosch, R., & Casey, J. A. (2021). Redlines and greenspace: the relationship between historical redlining and 2010 greenspace across the United States. Environmental health perspectives, 129(1), 017006.
- Robert K. Nelson, LaDale Winling, Richard Marciano, Nathan Connolly, et al., “Mapping Inequality,” American Panorama, ed. Robert K. Nelson and Edward L. Ayers, accessed October 17, 2023, https://dsl.richmond.edu/panorama/redlining/
- United States Environmental Protection Agency. 2015. EJSCREEN. Retrieved: October 13, 2025, from  [www.epa.gov/ejscreen](www.epa.gov/ejscreen)
-[U.S. Environmental Protection Agency (EPA), 2023. EJScreen Technical Documentation.](https://drive.google.com/file/d/1nG6Nj1bXfzQFOVMO8Km3eNy4SWu1YcIQ/view)